# üìö app-course-management ‚Äî Gesti√≥n de cursos

## Descripci√≥n
M√≥dulo responsable de gestionar la estructura completa de formaci√≥n: M√ìDULOS (conjuntos de cursos), CURSOS, CAP√çTULOS y MATERIAL asociado a cada cap√≠tulo. 
- Los administradores gestionan CRUD y relaciones entre estas entidades.
- Los usuarios pueden consumir contenido, marcar cap√≠tulos como vistos, consultar su hist√≥rico y obtener reconocimientos cuando completan cursos.

## Entidades y relaciones principales
- M√≥dulo (Module)
  - id, t√≠tulo, descripci√≥n
- Curso (Course)
  - id, t√≠tulo, descripci√≥n, duraci√≥n estimada
- Cap√≠tulo (Chapter)
  - curso, orden, t√≠tulo, descripcion, contenido
- Material (Material)
  - id, nombre, descripcion, tipo, url

### Entidades derivadas
- Historia de Usuario (UserHistory)
  - id, usurario, cap√≠tulo, fechaInicio, fechaFin
- Reconocimiento (Recognition)
  - id, usuario, curso, fechaEmision

Relaciones: Module \*..\* Course; Course 1..\* Chapter; Chapter 1..\* Material. UserProgress vincula usuarios con cap√≠tulos; Recognition se genera al completar un Course.

## Arquitectura
- Capas: Repository ‚Üí Service ‚Üí Controller.
- Persistencia: Spring Data JPA (esquema generado desde entidades).
- Seguridad: Spring Security + JWT (roles: ADMIN, USER).
- Estado: stateless APIs, front consume endpoints REST/JSON.

## Endpoints principales (resumen)

Usuario ‚Äî Consumo y progreso
- GET /api/v1/modules
  - Listar m√≥dulos
- GET /api/v1/modules/{id}
  - Obtener m√≥dulo con √≠ndice de cursos
- GET /api/v1/courses/{id}
  - Obtener curso con √≠ndice de cap√≠tulos y materiales
- POST /api/v1/courses/{courseId}/chapters/{chapterId}/mark-seen
  - Marcar cap√≠tulo como visto (registra UserHistory)
- GET /api/v1/users/{userId}/progress
  - Hist√≥rico de cap√≠tulos vistos y % de avance por curso
- GET /api/v1/users/{userId}/courses/{courseId}/recognition
  - Obtener/Generar reconocimiento si curso completado
- GET /api/v1/materials/{id}
  - Obtener un material dado.
- GET /api/v1/courses/{courseId}/chapters/{chapterId}/materials
  - Listar materiales de un cap√≠tulo.

Admin ‚Äî M√≥dulos / Cursos / Cap√≠tulos / Material
- POST /api/v1/modules
  - Crear m√≥dulo
- PUT /api/v1/modules/{id}
  - Actualizar m√≥dulo
- DELETE /api/v1/modules/{id}
  - Eliminar m√≥dulo (validar integridad o cascada)
- POST /api/v1/courses
  - Crear curso
- PUT /api/v1/courses/{id}
- DELETE /api/v1/courses/{id}
- POST /api/v1/modules/{id}/courses
  - Vincular un curso a un m√≥dulo.
- DELETE /api/v1/modules/{moduleId}/courses/{courseId}
  - Desvincular un curso de un m√≥dulo.
- POST /api/v1/courses/{courseId}/chapters/
  - A√±adir cap√≠tulo a curso
- PUT /api/v1/chapters/{id}
- DELETE /api/v1/chapters/{id}
- POST /api/v1/materials
- PUT /api/v1/materials/{id}
- DELETE /api/v1/materials/{id}
- POST /api/v1/chapters/{chapterId}/materials
  - A√±adir material a cap√≠tulo

## Modelos JSON (ejemplos)

Crear m√≥dulo (201 Created)
Solicitud:
```json
{
  "title": "M√≥dulo de Seguridad",
  "description": "Cursos sobre seguridad de la informaci√≥n",
}
```
Respuesta:
```json
{
  "moduleId": 13
}
```

Crear curso (201 Created)
Solicitud:
```json
{
  "title": "Introducci√≥n a OWASP",
  "description": "Fundamentos de seguridad web",
  "estimatedDurationMinutes": 120,
  "external_url": null
}
```
Respuesta:
```json
{
  "courseId": 19
}
```

Asociar curso a m√≥dulo (201 Created)
Solicitud:
```json
{
  "courseId": 15
}
```

A√±adir cap√≠tulo (201 Created)
Solicitud:
```json
{
  "courseId": 17,
  "order": 1,
  "title": "Top 10 OWASP",
  "description": "Resumen y ejemplos",
  "content": "...Markdown Text..."
}
```

A√±adir material (201 Created)
Solicitud:
```json
{
  "name": "V√≠deo de Ejemplo",
  "description": null,
  "type": "video",
  "filename": "owasp-intro.mp4",
  "data": "...Binary Data String..."
}
```
Respuesta:
```json
{
  "id": 18,
  "name": "V√≠deo de Ejemplo",
  "description": null,
  "type": "video",
  "url": "some-server.example/some-bucket/owasp-intro.mp4",
}
```


Marcar cap√≠tulo como visto (200 OK)
POST /api/courses/{courseId}/chapters/{chapterId}/mark-seen
Respuesta:
```json
{
  "courseId": 12,
  "chapterId": 13,
  "userId": 17,
  "startedAt": "2025-09-28T12:00:00Z",
  "endedAt": "2025-10-01T12:00:00Z"
}
```

Obtener reconocimiento (200 OK)
Respuesta:
```json
{
  "recognitionId": 15,
  "userId": 17,
  "courseId": 18,
  "issuedAt": "2025-10-02T09:00:00Z",
  "metadata": {
    "grade": "APROBADO",
    "durationMinutes": 120
  }
}
```

Errores comunes:
- 400 Bad Request ‚Äî validaci√≥n, datos faltantes.
- 401 Unauthorized ‚Äî token inv√°lido/expirado.
- 403 Forbidden ‚Äî rol insuficiente para admin.
- 404 Not Found ‚Äî recurso inexistente.
- 409 Conflict ‚Äî conflictos de integridad (p. ej. orden duplicado).

## Casos de uso clave
- Gesti√≥n completa por administradores: CRUD + reordenamiento de cap√≠tulos/curso.
- Seguimiento de avance por usuario y agregados por curso/m√≥dulo.
- Generaci√≥n de reconocimientos autom√°ticos al completar todos los cap√≠tulos de un curso.
- Soporte para m√∫ltiples tipos de material (video, documento, enlace) y control de acceso.

## Ejemplos r√°pidos (curl)

Crear m√≥dulo:
```bash
curl -X POST http://localhost:8080/api/v1/modules \
  -H "Authorization: Bearer <TOKEN_ADMIN>" \
  -H "Content-Type: application/json" \
  -d '{"title":"M√≥dulo de Seguridad","description":"Cursos sobre seguridad","order":1}'
```

Crear curso:
```bash
curl -X POST http://localhost:8080/api/v1/courses \
  -H "Authorization: Bearer <TOKEN_ADMIN>" \
  -H "Content-Type: application/json" \
  -d '{"title":"OWASP Intro","description":"Seguridad web","moduleId":"module-uuid","estimatedDurationMinutes":120}'
```

A√±adir cap√≠tulo:
```bash
curl -X POST http://localhost:8080/api/v1/courses/{courseId}/chapters \
  -H "Authorization: Bearer <TOKEN_ADMIN>" \
  -H "Content-Type: application/json" \
  -d '{"title":"Top 10 OWASP","summary":"Resumen","order":1}'
```

Marcar cap√≠tulo visto (usuario):
```bash
curl -X POST http://localhost:8080/api/courses/{courseId}/chapters/{chapterId}/mark-seen \
  -H "Authorization: Bearer <TOKEN_USER>" \
  -H "Content-Type: application/json" \
  -d '{"userId":"user-uuid"}'
```

Obtener hist√≥rico:
```bash
curl -X GET http://localhost:8080/api/users/{userId}/progress \
  -H "Authorization: Bearer <TOKEN_USER>"
```

Generar o obtener reconocimiento:
```bash
curl -X GET http://localhost:8080/api/users/{userId}/courses/{courseId}/recognition \
  -H "Authorization: Bearer <TOKEN_USER>"
```

## Notas de implementaci√≥n
- Validar integridad al eliminar (decidir cascada o bloqueo).
- Calcular avance por curso con porcentaje de cap√≠tulos vistos.
- Emitir evento/cola al generar reconocimiento para integraci√≥n con servicios externos (emails, almacenamiento de certificados).
- Registrar auditor√≠a de cambios (qui√©n cre√≥/actualiz√≥ eliminar).
